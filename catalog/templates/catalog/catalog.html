{% extends 'catalog/base.html' %}
{% load static %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ –ø–∞—Ä—Ñ—é–º–µ—Ä–∏–∏ - Sultanbi Perfumes{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/catalog.css' %}">
{% endblock %}

{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–∞—Ç–∞–ª–æ–≥ –ø–∞—Ä—Ñ—é–º–µ—Ä–∏–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/product.css' %}">
    <script src="{% static 'js/cart.js' %}" defer></script>
</head>
<body>
    <div id="main-container">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div class="container">
            <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫ –ø–µ—Ä–µ–¥ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ -->
            

            <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ —Ä—è–¥–æ–º —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ -->
            <div id="filter-toggle-btn">
                <span class="filter-icon">
                    <i class="fas fa-filter"></i>
                </span>
                <span class="filter-text">–§–∏–ª—å—Ç—Ä—ã</span>
            </div>

            <!-- –û–±–µ—Ä–Ω–∏—Ç–µ –≤–∞—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤ div —Å –∫–ª–∞—Å—Å–æ–º filters-section -->
            <div id="filters-section" class="filters-section">
                <div style="margin-top: 30px;" class="filters-wrapper">
                    <!-- –ü–æ–∏—Å–∫ -->
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ –ø–∞—Ä—Ñ—é–º–∞..." autofocus>
                    </div>

                    <!-- –§–∏–ª—å—Ç—Ä—ã -->
                    <div class="filters-container">
                        <div class="filter-group">
                            <label>–ë—Ä–µ–Ω–¥</label>
                            <select id="brandFilter" class="filter-select">
                                <option value="">–í—Å–µ –±—Ä–µ–Ω–¥—ã</option>
                                {% for brand in brands %}
                                    <option value="{{ brand|lower }}">{{ brand }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="filter-group">
                            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="categoryFilter" class="filter-select">
                                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                                {% for category in categories %}
                                    <option value="{{ category.id }}">{{ category.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="filter-group">
                            <label>–î–ª—è –∫–æ–≥–æ</label>
                            <select id="genderFilter" class="filter-select">
                                <option value="">–í—Å–µ –∞—Ä–æ–º–∞—Ç—ã</option>
                                {% for gender_code, gender_name in Gender.GENDER_CHOICES %}
                                    <option value="{{ gender_code }}">{{ gender_name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="filter-group price-range">
                            <label>–¶–µ–Ω–∞</label>
                            <div class="price-inputs">
                                <input type="number" id="minPrice" placeholder="–û—Ç" min="0">
                                <span>-</span>
                                <input type="number" id="maxPrice" placeholder="–î–æ" min="0">
                            </div>
                        </div>
                    </div>

                    <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
                    <div style="margin-top: 10px;" class="sort-box"> 
                        <label style="color: #d4af37;
                        font-size: 14px;font-weight: 600;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                         ">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                        <select style="margin-top: 10px;" id="sortSelect" class="filter-select">
                            <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                            <option value="price-asc">–¶–µ–Ω–∞: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                            <option value="price-desc">–¶–µ–Ω–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                            <option value="name-asc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é: –ê-–Ø</option>
                            <option value="name-desc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é: –Ø-–ê</option>
                        </select>
                    </div>
                </div>

                <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
                <div class="active-filters" id="activeFilters"></div>
            </div>

            <!-- –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
            <div class="products-grid">
                {% for perfume in perfumes %}
                <div class="product-card" 
                    data-brand="{{ perfume.brand|lower }}" 
                    data-category="{{ perfume.category.id }}" 
                    data-gender="{{ perfume.gender.name }}"
                    data-price="{% with first_volume=perfume.volumes.first %}{{ first_volume.price }}{% endwith %}"
                    data-name="{{ perfume.name|lower }}">
                    <div class="product-image">
                        <div class="image-container">
                            {% if perfume.is_hit %}
                                <img src="{% static 'images/hit1.png' %}" class="hit-label" alt="–•–∏—Ç –ø—Ä–æ–¥–∞–∂">
                            {% endif %}
                            {% if perfume.image %}
                            <a href="{% url 'perfume_detail' perfume.id %}">
                                <img src="{{ perfume.image.url }}" alt="{{ perfume.name }}" class="perfume-img">
                            </a>
                            {% else %}
                                <img src="{% static 'images/placeholder.jpg' %}" alt="–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" class="perfume-img">
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="product-info">
                        <h3 class="product-title">
                            <a class="perfume-link" href="{% url 'perfume_detail' perfume.id %}">{{ perfume.name }}</a>
                        </h3> 
                        {% if perfume.article %}
                            <div class="product-article">–ê—Ä—Ç–∏–∫—É–ª: {{ perfume.article }}</div>
                        {% endif %}
                        
                        {% if perfume.description %}
                            <div class="product-description">{{ perfume.description|truncatechars:100 }}</div>
                        {% endif %}
                        
                        <div class="product-sizes">
                            <div class="volume-control" data-product-id="{{ perfume.id }}">
                                <div class="volume-buttons">
                                    {% with in_stock_volumes=perfume.volumes.all %}
                                    {% if in_stock_volumes %}
                                        <button class="volume-btn minus-btn" onclick="decreaseVolume(this, '{{ perfume.id }}')">-</button>
                                        <span class="current-volume" data-index="0">
                                            {% for v in in_stock_volumes %}
                                                {% if forloop.first %}
                                                    {{ v.volume.size }} –º–ª
                                                {% endif %}
                                            {% endfor %}
                                        </span>
                                        <button class="volume-btn plus-btn" onclick="increaseVolume(this, '{{ perfume.id }}')">+</button>
                                    {% else %}
                                        <span class="out-of-stock">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                                    {% endif %}
                                    {% endwith %}
                                </div>
                            </div>
                        </div>

                        <div class="product-price" id="price-{{ perfume.id }}">
                            {% with first_volume=perfume.volumes.first %}
                                {% if first_volume and first_volume.in_stock %}
                                    <span class="price-value">{{ first_volume.price }}</span> —Ç–≥.
                                {% else %}
                                    –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                                {% endif %}
                            {% endwith %}
                        </div>
                        
                        <div class="product-actions">
                            <button class="details-button" onclick="window.location.href='{% url 'perfume_detail' perfume.id %}'">
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                            {% if perfume.volumes.first and perfume.volumes.first.in_stock %}
                            <button class="buy-button" onclick="addToCart('{{ perfume.id }}', '{{ perfume.name|escapejs }}', getCurrentPrice('{{ perfume.id }}'), '{% if perfume.image %}{{ perfume.image.url }}{% else %}{% static 'images/no-image.png' %}{% endif %}', getCurrentVolume('{{ perfume.id }}'))">
                                –ö—É–ø–∏—Ç—å
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
    // –û–±—ä–µ–∫—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—ä–µ–º—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä—Ñ—é–º–∞
    const productVolumes = {
        {% for perfume in perfumes %}
        "{{ perfume.id }}": [
            {% for volume in perfume.volumes.all %}
                {% if volume.in_stock %}
                {
                    "size": {{ volume.volume.size }},
                    "label": "{{ volume.volume.size }} –º–ª",
                    "price": {{ volume.price }}
                }{% if not forloop.last %},{% endif %}
                {% endif %}
            {% endfor %}
        ]{% if not forloop.last %},{% endif %}
        {% endfor %}
    };

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–º–∞–º–∏
    function decreaseVolume(btn, productId) {
        const volumeSpan = btn.nextElementSibling;
        const currentIndex = parseInt(volumeSpan.dataset.index);
        const volumes = productVolumes[productId];
        
        if (currentIndex > 0) {
            const newIndex = currentIndex - 1;
            volumeSpan.dataset.index = newIndex;
            volumeSpan.textContent = volumes[newIndex].label;
            updatePrice(productId, volumes[newIndex].price);
        }
    }
    
    function increaseVolume(btn, productId) {
        const volumeSpan = btn.previousElementSibling;
        const currentIndex = parseInt(volumeSpan.dataset.index);
        const volumes = productVolumes[productId];
        
        if (currentIndex < volumes.length - 1) {
            const newIndex = currentIndex + 1;
            volumeSpan.dataset.index = newIndex;
            volumeSpan.textContent = volumes[newIndex].label;
            updatePrice(productId, volumes[newIndex].price);
        }
    }
    
    function updatePrice(productId, price) {
        const priceElement = document.getElementById(`price-${productId}`);
        if (priceElement) {
            priceElement.querySelector('.price-value').textContent = price;
        }
    }

    function getCurrentPrice(productId) {
        const priceElement = document.getElementById(`price-${productId}`);
        return priceElement.querySelector('.price-value').textContent;
    }

    function getCurrentVolume(productId) {
        const volumeSpan = document.querySelector(`.volume-control[data-product-id="${productId}"] .current-volume`);
        const volumes = productVolumes[productId];
        const index = parseInt(volumeSpan.dataset.index);
        return volumes[index].size;
    }

    function getCurrentVolumeLabel(productId) {
        const volumeSpan = document.querySelector(`.volume-control[data-product-id="${productId}"] .current-volume`);
        return volumeSpan.textContent;
    }
    </script>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownMenu');
            dropdown.classList.toggle('show');
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            if (!event.target.matches('.menu-toggle') && !event.target.matches('.menu-toggle-icon')) {
                const dropdown = document.getElementById('dropdownMenu');
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫ —Ä–∞–∑–¥–µ–ª—É
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
            const dropdown = document.getElementById('dropdownMenu');
            dropdown.classList.remove('show');
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏
            return false;
        }
    </script>

    <script>
    // –î–æ–±–∞–≤–∏–º —É–ª—É—á—à–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
    function updateActiveFilters() {
        const activeFilters = document.getElementById('activeFilters');
        activeFilters.innerHTML = '';
        
        // –ë—Ä–µ–Ω–¥
        const brandFilter = document.getElementById('brandFilter');
        if (brandFilter.value) {
            const filterTag = document.createElement('div');
            filterTag.className = 'filter-tag';
            filterTag.innerHTML = `
                <span class="filter-name">–ë—Ä–µ–Ω–¥:</span>
                <span class="filter-value">${brandFilter.options[brandFilter.selectedIndex].text}</span>
                <span class="remove-filter" onclick="clearFilter('brandFilter')">√ó</span>
            `;
            activeFilters.appendChild(filterTag);
        }
        
        // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
        const categoryFilter = document.getElementById('categoryFilter');
        if (categoryFilter.value) {
            const filterTag = document.createElement('div');
            filterTag.className = 'filter-tag';
            filterTag.innerHTML = `
                <span class="filter-name">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                <span class="filter-value">${categoryFilter.options[categoryFilter.selectedIndex].text}</span>
                <span class="remove-filter" onclick="clearFilter('categoryFilter')">√ó</span>
            `;
            activeFilters.appendChild(filterTag);
        }
        
        // –ü–æ–ª
        const genderFilter = document.getElementById('genderFilter');
        if (genderFilter.value) {
            const filterTag = document.createElement('div');
            filterTag.className = 'filter-tag';
            filterTag.innerHTML = `
                <span class="filter-name">–î–ª—è:</span>
                <span class="filter-value">${genderFilter.options[genderFilter.selectedIndex].text}</span>
                <span class="remove-filter" onclick="clearFilter('genderFilter')">√ó</span>
            `;
            activeFilters.appendChild(filterTag);
        }
        
        // –¶–µ–Ω–∞
        const minPrice = document.getElementById('minPrice').value;
        const maxPrice = document.getElementById('maxPrice').value;
        if (minPrice || maxPrice) {
            const filterTag = document.createElement('div');
            filterTag.className = 'filter-tag';
            let priceText = '';
            if (minPrice && maxPrice) {
                priceText = `${minPrice} - ${maxPrice} —Ç–≥.`;
            } else if (minPrice) {
                priceText = `–æ—Ç ${minPrice} —Ç–≥.`;
            } else if (maxPrice) {
                priceText = `–¥–æ ${maxPrice} —Ç–≥.`;
            }
            filterTag.innerHTML = `
                <span class="filter-name">–¶–µ–Ω–∞:</span>
                <span class="filter-value">${priceText}</span>
                <span class="remove-filter" onclick="clearPriceFilter()">√ó</span>
            `;
            activeFilters.appendChild(filterTag);
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞
    function clearFilter(filterId) {
        document.getElementById(filterId).value = '';
        applyFilters();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞ —Ü–µ–Ω—ã
    function clearPriceFilter() {
        document.getElementById('minPrice').value = '';
        document.getElementById('maxPrice').value = '';
        applyFilters();
    }
    </script>
</body>

<!-- –§—É—Ç–µ—Ä —Å–∞–π—Ç–∞ -->
<footer class="site-footer">
    <div class="footer-content">
        
        
        <div class="footer-column" id="footer-contacts">
            <h3 class="footer-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
            <div class="footer-contact-item">
                <svg class="footer-contact-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19.44,13c-.22,0-.45-.07-.67-.12a9.44,9.44,0,0,1-1.31-.39,2,2,0,0,0-2.48,1l-.22.45a12.18,12.18,0,0,1-2.66-2,12.18,12.18,0,0,1-2-2.66L10.52,9a2,2,0,0,0,1-2.48,10.33,10.33,0,0,1-.39-1.31c-.05-.22-.09-.45-.12-.68a3,3,0,0,0-3-2.49h-3a3,3,0,0,0-3,3.41A19,19,0,0,0,18.53,21.91l.38,0a3,3,0,0,0,2-.76,3,3,0,0,0,1-2.25v-3A3,3,0,0,0,19.44,13Zm.5,6a1,1,0,0,1-.34.75,1.05,1.05,0,0,1-.82.25A17,17,0,0,1,4.07,5.22a1.09,1.09,0,0,1,.25-.82,1,1,0,0,1,.75-.34h3A1,1,0,0,1,9,5.2l.42,0a6.66,6.66,0,0,0,.24.74,7.7,7.7,0,0,0,.3,1l-1.17.4a1,1,0,0,0-.62,1.26,13.49,13.49,0,0,0,2.5,4.15,13.57,13.57,0,0,0,4.15,2.5,1,1,0,0,0,1.26-.62l.4-1.17a7.7,7.7,0,0,0,1,.3,6.66,6.66,0,0,0,.74.24l0,.42a1,1,0,0,1,.14.89Zm0,0"></path>
                </svg>
                <span>+7 775 433 2453</span>
            </div>
            <div class="footer-contact-item">
                <svg class="footer-contact-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19,4H5A3,3,0,0,0,2,7V17a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V7A3,3,0,0,0,19,4Zm-.41,2-5.88,5.88a1,1,0,0,1-1.42,0L5.41,6ZM20,17a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V7.41l5.88,5.88a3,3,0,0,0,4.24,0L20,7.41Z"></path>
                </svg>
                <span>sultanbi.oud@gmail.com</span>
            </div>
            
            <h3 class="footer-title" style="margin-top: 20px;">–ú—ã –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö</h3>
            <div class="social-links">
                <a href="https://www.instagram.com/sultanbi.oud/" class="social-link" target="_blank">
                    <img src="{% static 'images/instagram.png' %}" alt="Instagram">
                </a>
                <a href="https://wa.me/87754332453" class="social-link" target="_blank">
                    <img src="{% static 'images/whatsapp.png' %}" alt="WhatsApp">
                </a>
            </div>
        </div>
        
        <div class="footer-column" id="footer-location">
            <h3 class="footer-title">–ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è</h3>
            <div class="how-to-get">
                <div class="address-detail">
                    <div class="address-icon">üìç</div>
                    <div class="address-text">
                        <div class="address-title">–ù–∞—à –∞–¥—Ä–µ—Å</div>
                        <div class="address-info">–≥. –ê—Ç—ã—Ä–∞—É, —É–ª. –°–∞—Ç–ø–∞–µ–≤–∞, 15, –¢–¶ "–°—É–ª—Ç–∞–Ω"</div>
                    </div>
                </div>
                <div class="address-detail">
                    <div class="address-icon">üïí</div>
                    <div class="address-text">
                        <div class="address-title">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</div>
                        <div class="address-info">–ü–Ω-–í—Å: 10:00 - 20:00</div>
                    </div>
                </div>
                <div class="address-detail">
                    <div class="address-icon">üöó</div>
                 
    
    <div class="footer-bottom">
        <p>¬© 2025 Sultanbi Oud. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    </div>
</footer>

</html>
{% endblock %}
